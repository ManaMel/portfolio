<%= render 'layouts/header' %>
<button class="absolute top-4 right-4 btn btn-success">
  <%= link_to "ログアウト", destroy_user_session_path, data: { turbo_method: :delete } %>
</button>

<div class="space-y-6 text-green-900 text-lg text-center items-center">

  <!-- タイトル -->
  <h1 class="font-bold text-2xl">♪ 歌声や演奏を録音 ♪</h1>

  <!-- 録音操作ボタン -->
  <div class="flex justify-center gap-4">
    <button type="button" id="buttonStart" class="bg-green-800 text-white rounded px-4 py-2 disabled:bg-gray-400">録音開始</button>
    <button type="button" id="buttonStop" class="bg-red-800 text-white rounded px-4 py-2 disabled:bg-gray-400" disabled>録音停止</button>
    <button type="button" id="buttonPlay" class="bg-pink-800 text-white rounded px-4 py-2 disabled:bg-gray-400">再生</button>
  </div>

  <!-- 波形表示 -->
  <div id="waveform" class="my-4"></div>

  <!-- エフェクトUI -->
  <div class="grid grid-cols-1 gap-4 max-w-md mx-auto text-left">
    <h3 class="font-bold text-lg">エフェクト</h3>
    <label>
      音量
      <input type="range" id="volumeSlider" min="0" max="10" step="0.01" value="1" class="w-full">
    </label>
    <label>
      リバーブ
      <input type="range" id="reverbSlider" min="0" max="1" step="0.01" value="0.5" class="w-full">
    </label>
    <label>
      エコー遅延時間
      <input type="range" id="echoDelay" min="0" max="1" step="0.01" value="0.3" class="w-full">
    </label>
    <label>
      エコー残響量
      <input type="range" id="echoFeedback" min="0" max="0.95" step="0.01" value="0.4" class="w-full">
    </label>
  </div>

  <!-- 録音保存フォーム -->
  <div class="max-w-lg mx-auto mt-8 card bg-base-200 p-6 rounded-2xl shadow-lg">
    <h2 class="text-xl font-bold mb-4">録音を保存</h2>

    <div class="mb-4">
      <label class="label">
        <span class="label-text font-semibold">タイトル</span>
      </label>
      <!-- recording.jsで参照されるID: recording_title（ハイフンではなくアンダースコア） -->
      <input id="recording_title" type="text" placeholder="例：サビだけ録音 2025/01/01" class="input input-bordered w-full">
    </div>

    <div class="mb-6">
      <label class="label">
        <span class="label-text font-semibold">録音データ</span>
      </label>
      <div id="recording-info" class="text-sm opacity-70">
        ※ まだ録音データが未取得です
      </div>
    </div>

    <!-- recording.jsで参照されるID: save-recording-btn -->
    <button id="save-recording-btn" class="btn btn-primary btn-block" disabled>保存する</button>

    <!-- マイページボタン -->
    <div class="mt-4 text-center">
      <%= link_to "自分の録音を確認する", mypage_path, class: "btn btn-outline btn-wide btn-warning" %>
    </div>
  </div>

  <!-- 伴奏動画選択 -->
  <div class="mt-6">
    <button class="btn btn-wide btn-outline btn-warning mb-2"><%= link_to "♪ 伴奏動画を選択する", videos_path %></button>
    <p class="font-bold">♪ ↓ 伴奏動画 ↓ ♪</p>
  </div>

  <!-- 伴奏動画表示 -->
  <div class="flex justify-center contents__content mt-4">
    <% if @selected_video.present? %>
      <iframe width="560" height="315"
        src="https://www.youtube.com/embed/<%= find_youtube_id(@selected_video.video_url) %>"
        frameborder="0"
        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
      </iframe>

      <div class="flex justify-center mt-2">
        <%= link_to video_path(@selected_video), data: { turbo_method: :delete } do %>
          <%= render "shared/icon_buttons/delete_button" %>
        <% end %>
      </div>
    <% else %>
      <p>伴奏動画が選択されていません</p>
    <% end %>
  </div>

</div>