<h2 class="text-2xl font-bold mb-4">あなたの録音一覧</h2>

<% @recordings.each do |recording| %>
  <div class="p-4 bg-base-200 rounded-xl shadow mb-6">
    
    <h3 class="text-xl font-semibold"><%= recording.title %></h3>

    <!-- 元の録音 -->
    <% if recording.original_audio.attached? %>
      <audio controls class="mt-1 w-full">
        <source src="<%= url_for(recording.original_audio) %>">
      </audio>
    <% end %>

    <!-- 伴奏 -->
    <% if recording.accompaniment.attached? %>
      <audio controls class="mt-1 w-full">
        <source src="<%= url_for(recording.accompaniment) %>">
      </audio>
    <% else %>
      <%= link_to "伴奏を選ぶ", select_accompaniment_recording_path(recording), class: "btn btn-sm btn-info mt-2" %>
    <% end %>

    <!-- ▼ ステータス表示 -->
    <% if recording.generating? %>
      <p class="mt-3 text-yellow-600 font-semibold">音声を生成中です…</p>
      
      <!-- リロードボタン -->
      <button
        onclick="location.reload()"
        class="btn btn-sm btn-outline mt-1"
      >
        生成状況を確認する
      </button>

    <% elsif recording.generated? && !recording.generated_audio.attached? %>
      <p class="mt-3 text-green-600 font-semibold">
        生成が完了しました。
        <%= link_to "更新して確認する", request.original_url, class: "btn btn-sm btn-outline mt-1" %>
      </p>
    <% end %>

    <!-- ミックス済み音声 -->
    <% if recording.generated_audio.attached? %>
      <p class="font-bold mt-4">🎧 ミックス済み音声</p>
      <audio controls class="mt-2 w-full">
        <source src="<%= url_for(recording.generated_audio) %>" type="<%= recording.generated_audio.content_type %>">
      </audio>
    <% end %>

    <!-- 音声生成／再生成ボタン -->
    <%= form_with url: generate_audio_recording_path(recording), method: :post, local: true do %>
      <% if recording.generated_audio.attached? %>
        <%= submit_tag "再生成する", class: "btn btn-sm btn-warning mt-2" %>
      <% else %>
        <%= submit_tag "音声を生成する", class: "btn btn-primary btn-sm mt-2" %>
      <% end %>
    <% end %>

  </div>
<% end %>
