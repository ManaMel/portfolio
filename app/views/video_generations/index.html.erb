<!-- app/views/video_generations/index.html.erb -->

<h1 class="text-2xl font-bold mb-6">éŸ³å£°ãƒ»å‹•ç”»ç”Ÿæˆ</h1>

<div class="space-y-6">

  <% @recordings.each do |recording| %>
    <div class="card bg-base-200 shadow-lg p-6 rounded-2xl">
      <h2 class="text-xl font-bold mb-2">
        ğŸ¤ <%= recording.title.presence || "ç„¡é¡Œã®éŒ²éŸ³" %>
      </h2>

      <% if recording.original_audio.attached? %>
        <p class="text-sm opacity-70 mb-4">
          éŒ²éŸ³æ—¥æ™‚: <%= recording.created_at.strftime("%Y/%m/%d %H:%M") %>
        </p>
      <% end %>

      <!-- ãƒ•ã‚©ãƒ¼ãƒ é–‹å§‹ -->
      <%= form_with url: generate_audio_video_generations_path, 
                    method: :post,
                    local: true,
                    html: { enctype: "multipart/form-data" } do |f| %>

        <!-- recording_id ã‚’ hidden ã§é€ã‚‹ -->
        <%= hidden_field_tag :recording_id, recording.id %>

        <label 
          class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed 
                 border-primary rounded-xl cursor-pointer hover:bg-base-300 transition">
          
          <span class="text-primary font-semibold">ä¼´å¥éŸ³æºã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</span>
          <span class="text-sm opacity-70">mp3 / wav å½¢å¼ã«å¯¾å¿œ</span>

          <%= file_field_tag :accompaniment, 
                class: "hidden", 
                accept: "audio/*",
                id: "accomp-file-#{recording.id}" %>
        </label>

        <div id="selected-file-<%= recording.id %>" 
             class="mt-2 text-sm text-center opacity-80"></div>

        <script>
          document.addEventListener("DOMContentLoaded", () => {
            const input = document.getElementById("accomp-file-<%= recording.id %>");
            const out = document.getElementById("selected-file-<%= recording.id %>");
            input.addEventListener("change", () => {
              out.innerText = input.files.length ? `é¸æŠä¸­: ${input.files[0].name}` : "";
            });
          });
        </script>

        <div class="mt-4 flex justify-end">
          <%= f.submit "éŸ³å£°ç”Ÿæˆ", class: "btn btn-primary" %>
        </div>

      <% end %>
      <!-- ãƒ•ã‚©ãƒ¼ãƒ çµ‚äº† -->

    </div>
  <% end %>
</div>
